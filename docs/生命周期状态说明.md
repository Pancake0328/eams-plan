# 资产生命周期状态说明

## 生命周期阶段定义

### 1. 购入（Stage = 1）
- **含义**：采购单创建后，资产处于采购阶段（按采购数量生成对应资产）
- **允许操作**：
  - ✅ 变更为"使用中"
  - ✅ 变更为"闲置"
- **禁止操作**：
  - ❌ 不能直接报废（需要先使用或闲置）

### 2. 使用中（Stage = 2）
- **含义**：资产正在正常使用中
- **允许操作**：
  - ✅ 变更为"维修中"
  - ✅ 变更为"闲置"
  - ✅ 变更为"报废"
  - ✅ 可以分配给用户
- **禁止操作**：无

### 3. 维修中（Stage = 3）
- **含义**：资产正在维修，暂时无法使用
- **允许操作**：
  - ✅ 维修完成后可变更为"使用中"
  - ✅ 维修完成后可变更为"闲置"
  - ✅ 无法维修可变更为"报废"
- **禁止操作**：
  - ❌ 不能分配给用户
  - ❌ 不能借出

### 4. 闲置（Stage = 4）
- **含义**：资产未使用，处于空闲状态
- **允许操作**：
  - ✅ 变更为"使用中"
  - ✅ 变更为"报废"
  - ✅ 可以分配给用户
- **禁止操作**：无

### 5. 报废（Stage = 5）
- **含义**：资产已报废，不再使用
- **允许操作**：无
- **禁止操作**：
  - ❌ 不能再分配
  - ❌ 不能借出
  - ❌ 不能变更为其他状态（最终状态）

### 6. 取消采购（Stage = 6）
- **含义**：采购单取消，资产生命周期终止
- **允许操作**：无
- **禁止操作**：不可变更为其他状态（最终状态）

## 状态流转规则

```
购入(1) ──→ 闲置(4) ──→ 使用中(2) ──→ 维修中(3) ──→ 使用中(2)
  │           │           │
  ↓           ↓           ↓
取消采购(6) ──┴───────────┴──→ 报废(5)
```

### 合法的状态变更路径

| 当前状态 | 可变更到的状态 | 说明 |
|---------|--------------|------|
| 购入(1) | 闲置(4)、取消采购(6) | 采购完成后入库为闲置或取消采购 |
| 使用中(2) | 维修中(3)、闲置(4)、报废(5) | 正常使用过程中的状态变化 |
| 维修中(3) | 使用中(2)、闲置(4)、报废(5) | 维修结果决定后续状态 |
| 闲置(4) | 使用中(2)、报废(5) | 闲置资产的重新启用或报废 |
| 报废(5) | 无 | 最终状态，不可逆 |
| 取消采购(6) | 无 | 最终状态，不可逆 |

## 业务约束

### 1. 报废资产约束
- 报废资产不可再分配
- 报废资产不可借出
- 报废资产不计入资产统计
- 报废需要填写报废原因

### 2. 维修中资产约束
- 维修中资产不可分配
- 维修中资产不可借出
- 需要关联报修单

### 3. 变更原因必填
- 每次状态变更必须填写变更原因
- 原因需要详细说明状态变更的背景

### 4. 操作人追溯
- 每次状态变更必须记录操作人
- 保留完整的变更历史

## 盘点结果类型

### 1. 未盘点（Result = 1）
- **含义**：盘点计划中但尚未执行盘点
- **状态**：待盘点

### 2. 正常（Result = 2）
- **含义**：资产实物与账面一致，位置正确，状态良好
- **处理**：无需特殊处理

### 3. 位置异常（Result = 3）
- **含义**：资产实物存在但位置与预期不符
- **处理**：
  - 记录实际位置
  - 更新资产位置信息
  - 标记为异常资产

### 4. 状态异常（Result = 4）
- **含义**：资产存在但状态与预期不符（如损坏、老化）
- **处理**：
  - 记录异常情况
  - 可能需要报修
  - 标记为异常资产

### 5. 丢失（Result = 5）
- **含义**：资产账面存在但实物未找到
- **处理**：
  - 标记为丢失
  - 自动标记为异常资产
  - 需要上报并处理

## 报修类型

### 1. 日常维修（Type = 1）
- **定义**：日常保养、清洁、小修小补
- **优先级**：普通或低
- **示例**：电脑清灰、键盘清洁

### 2. 故障维修（Type = 2）
- **定义**：资产出现故障需要维修
- **优先级**：根据影响程度确定
- **示例**：电脑无法开机、显示器闪屏

### 3.  预防性维修（Type = 3）
- **定义**：定期维护保养，预防故障
- **优先级**：普通
- **示例**：定期检查、零件更换

## 报修优先级

### 1. 紧急（Priority = 1）
- **响应时间**：立即响应
- **适用场景**：影响核心业务的关键设备故障
- **处理**：优先审批、优先维修

### 2. 普通（Priority = 2）
- **响应时间**：24小时内响应
- **适用场景**：一般设备故障
- **处理**：按正常流程审批维修

### 3. 低（Priority = 3）
- **响应时间**：48小时内响应
- **适用场景**：非紧急的维修需求
- **处理**：可安排计划性维修

## 使用示例

### 示例1：新资产入库流程
```
1. 采购完成 → 创建生命周期记录（购入）
2. 分配使用 → 变更状态（使用中）
3. 记录操作人和原因："分配给技术部张三使用"
```

### 示例2：资产维修流程
```
1. 发现故障 → 创建报修单
2. 审批通过 → 变更生命周期（维修中）
3. 维修完成 → 完成报修单
4. 恢复使用 → 变更生命周期（使用中）
```

### 示例3：资产盘点流程
```
1. 创建盘点计划 → 指定盘点范围和时间
2. 开始盘点 → 状态变更为"进行中"
3. 逐一盘点 → 记录盘点结果
4. 完成盘点 → 统计正常/异常数量
5. 处理异常 → 丢失资产标记、位置更新等
```

## 注意事项

1. **状态变更的原子性**：每次状态变更必须记录完整信息
2. **历史可追溯**：所有状态变更历史永久保存
3. **资产流转同步**：分配/调拨/归还/送修/维修完成/报废会自动写入生命周期
4. **变更前后信息**：生命周期记录包含变更前/后部门与责任人
5. **异常提醒**：盘点发现异常自动通知相关人员
6. **权限控制**：状态变更需要相应权限
7. **数据一致性**：状态变更需要同步更新资产主表状态
